# xxljob-enhance

> ä¸º XXL-Job ä»»åŠ¡æä¾›ç»†ç²’åº¦æƒé™æ§åˆ¶çš„å¢å¼ºç³»ç»Ÿ

[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)
[![Node.js](https://img.shields.io/badge/node-%3E%3D20.0.0-brightgreen)](https://nodejs.org)
[![Docker](https://img.shields.io/badge/docker-%3E%3D20.10-blue)](https://www.docker.com)

---

## ğŸ“– é¡¹ç›®ç®€ä»‹

**xxljob-enhance** æ˜¯ä¸€ä¸ªä¸º [XXL-Job](https://github.com/xuxueli/xxl-job) æä¾›**ä»»åŠ¡çº§æƒé™ç®¡ç†**çš„å¢å¼ºç³»ç»Ÿã€‚

XXL-Job åŸç”Ÿåªæ”¯æŒ**æ‰§è¡Œå™¨çº§åˆ«**çš„æƒé™æ§åˆ¶ï¼Œæ— æ³•ç²¾ç¡®æ§åˆ¶ç”¨æˆ·å¯¹å•ä¸ªä»»åŠ¡çš„æ“ä½œæƒé™ã€‚æœ¬é¡¹ç›®é€šè¿‡ç‹¬ç«‹çš„æƒé™ç®¡ç†ç³»ç»Ÿï¼Œå®ç°ï¼š

âœ… **ä»»åŠ¡çº§æƒé™æ§åˆ¶** - ç²¾ç¡®æ§åˆ¶æ¯ä¸ªç”¨æˆ·å¯¹æ¯ä¸ªä»»åŠ¡çš„ `æŸ¥çœ‹/æ‰§è¡Œ/ç¼–è¾‘` æƒé™
âœ… **åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC)** - çµæ´»çš„è§’è‰²å’Œæƒé™åˆ†é…
âœ… **æƒé™ OR åˆå¹¶é€»è¾‘** - ç”¨æˆ·å¤šè§’è‰²æƒé™è‡ªåŠ¨åˆå¹¶
âœ… **å®Œæ•´å®¡è®¡æ—¥å¿—** - è®°å½•æ‰€æœ‰ä»»åŠ¡æ“ä½œå†å²
âœ… **å‹å¥½çš„å‰ç«¯ç•Œé¢** - åŸºäº React + Ant Design çš„ç®¡ç†ç•Œé¢
âœ… **ä¸€é”® Docker éƒ¨ç½²** - å¼€ç®±å³ç”¨çš„å®¹å™¨åŒ–éƒ¨ç½²æ–¹æ¡ˆ

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          xxljob-enhance Frontend            â”‚
â”‚       (React + Ant Design + Vite)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ HTTP/REST API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          xxljob-enhance Backend             â”‚
â”‚       (NestJS + Prisma + SQLite)            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚  æƒé™éªŒè¯å±‚ (RBAC)                â”‚     â”‚
â”‚   â”‚  - JobPermissionGuard            â”‚     â”‚
â”‚   â”‚  - AdminGuard                     â”‚     â”‚
â”‚   â”‚  - OR é€»è¾‘æƒé™åˆå¹¶                â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                   â”‚                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚  ä¸šåŠ¡å±‚ (Services)                â”‚     â”‚
â”‚   â”‚  - AuthService                    â”‚     â”‚
â”‚   â”‚  - PermissionsService             â”‚     â”‚
â”‚   â”‚  - XxlJobService (API Proxy)      â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                   â”‚                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚  æ•°æ®å±‚ (Prisma ORM)              â”‚     â”‚
â”‚   â”‚  - SQLite Database                â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ HTTP API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            XXL-Job Admin                    â”‚
â”‚       (åŸæœ‰çš„ XXL-Job è°ƒåº¦ä¸­å¿ƒ)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- **Docker** >= 20.10
- **Docker Compose** >= 2.0
- **XXL-Job Admin** (å·²éƒ¨ç½²å¹¶è¿è¡Œ)

### ä¸€é”®éƒ¨ç½²

1. **å…‹éš†é¡¹ç›®**
   ```bash
   git clone https://github.com/your-org/xxljob-enhance.git
   cd xxljob-enhance
   ```

2. **é…ç½®ç¯å¢ƒå˜é‡**
   ```bash
   cp .env.example .env
   # ç¼–è¾‘ .env æ–‡ä»¶ï¼Œä¿®æ”¹ä»¥ä¸‹å¿…éœ€é…ç½®ï¼š
   # - JWT_SECRET (ç”Ÿäº§ç¯å¢ƒå¿…æ”¹ï¼)
   # - XXL_JOB_ADMIN_URL
   # - XXL_JOB_ADMIN_USERNAME
   # - XXL_JOB_ADMIN_PASSWORD
   ```

3. **å¯åŠ¨æœåŠ¡**
   ```bash
   docker compose up -d
   ```

4. **è®¿é—®åº”ç”¨**
   - å‰ç«¯ç•Œé¢: http://localhost
   - API æ–‡æ¡£: http://localhost:3000/api-docs
   - åç«¯ API: http://localhost:3000

5. **åˆ›å»ºåˆå§‹ç®¡ç†å‘˜è´¦å·**
   å‚è§ [éƒ¨ç½²æ–‡æ¡£ - åˆå§‹åŒ–ç®¡ç†å‘˜è´¦å·](docs/deployment.md#åˆå§‹åŒ–ç®¡ç†å‘˜è´¦å·)

---

## ğŸ“¦ æœ¬åœ°å¼€å‘

### åç«¯å¼€å‘

```bash
cd backend

# å®‰è£…ä¾èµ–
npm install

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env

# ç”Ÿæˆ Prisma Client
npx prisma generate

# è¿è¡Œæ•°æ®åº“è¿ç§»
npx prisma migrate dev

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run start:dev

# è¿è¡Œæµ‹è¯•
npm run test        # å•å…ƒæµ‹è¯•
npm run test:e2e    # E2E æµ‹è¯•
npm run test:cov    # æµ‹è¯•è¦†ç›–ç‡
```

### å‰ç«¯å¼€å‘

```bash
cd frontend

# å®‰è£…ä¾èµ–
npm install

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# è¿è¡Œæµ‹è¯•
npm run test

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build
```

---

## ğŸ”‘ æ ¸å¿ƒåŠŸèƒ½

### 1. ä»»åŠ¡çº§æƒé™æ§åˆ¶

**ä¸‰ç§æƒé™ç±»å‹**ï¼š
- **view** (æŸ¥çœ‹) - å¯ä»¥æŸ¥çœ‹ä»»åŠ¡è¯¦æƒ…
- **execute** (æ‰§è¡Œ) - å¯ä»¥è§¦å‘ä»»åŠ¡æ‰§è¡Œ
- **edit** (ç¼–è¾‘) - å¯ä»¥å¯åŠ¨/åœæ­¢ä»»åŠ¡

**ç¤ºä¾‹**ï¼š
- å¼€å‘è€…è§’è‰²ï¼šå¯ä»¥æŸ¥çœ‹å’Œæ‰§è¡Œä»»åŠ¡ï¼Œä½†ä¸èƒ½å¯åŠ¨/åœæ­¢
- è¿ç»´è§’è‰²ï¼šæ‹¥æœ‰å®Œæ•´æƒé™
- æµ‹è¯•è§’è‰²ï¼šåªèƒ½æŸ¥çœ‹ä»»åŠ¡

### 2. OR é€»è¾‘æƒé™åˆå¹¶

ç”¨æˆ·å¯ä»¥æ‹¥æœ‰å¤šä¸ªè§’è‰²ï¼Œæƒé™ä¼šè‡ªåŠ¨åˆå¹¶ï¼š

```
è§’è‰² A å¯¹ä»»åŠ¡ 1: canView=true, canExecute=false
è§’è‰² B å¯¹ä»»åŠ¡ 1: canView=false, canExecute=true
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
åˆå¹¶ç»“æœ:        canView=true, canExecute=true âœ…
```

### 3. å®¡è®¡æ—¥å¿—

ç³»ç»Ÿè‡ªåŠ¨è®°å½•æ‰€æœ‰å…³é”®æ“ä½œï¼š
- ç”¨æˆ·ç™»å½•/ç™»å‡º
- ä»»åŠ¡æ‰§è¡Œ/å¯åŠ¨/åœæ­¢
- æƒé™å˜æ›´
- ç”¨æˆ·å’Œè§’è‰²ç®¡ç†

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### åç«¯
- **æ¡†æ¶**: NestJS 11.x
- **ORM**: Prisma 6.x
- **æ•°æ®åº“**: SQLite (å¯æ›¿æ¢ä¸º PostgreSQL/MySQL)
- **è®¤è¯**: JWT (Access Token + Refresh Token)
- **API æ–‡æ¡£**: Swagger/OpenAPI
- **æµ‹è¯•**: Jest (88 ä¸ªæµ‹è¯•ç”¨ä¾‹)

### å‰ç«¯
- **æ¡†æ¶**: React 19.x
- **UI åº“**: Ant Design 5.x
- **è·¯ç”±**: React Router 7.x
- **æ„å»ºå·¥å…·**: Vite 7.x
- **çŠ¶æ€ç®¡ç†**: React Context API
- **HTTP å®¢æˆ·ç«¯**: Axios
- **æµ‹è¯•**: Vitest + React Testing Library

### DevOps
- **å®¹å™¨åŒ–**: Docker + Docker Compose
- **å¤šé˜¶æ®µæ„å»º**: ä¼˜åŒ–é•œåƒå¤§å°
- **å¥åº·æ£€æŸ¥**: å†…ç½®å¥åº·æ£€æŸ¥ç«¯ç‚¹
- **æ•°æ®æŒä¹…åŒ–**: Docker Named Volumes

---

## ğŸ“š æ–‡æ¡£

- [éƒ¨ç½²æ–‡æ¡£](docs/deployment.md) - Docker éƒ¨ç½²ã€ç¯å¢ƒå˜é‡ã€åˆå§‹åŒ–
- [API æ–‡æ¡£](docs/api.md) - REST API æ¥å£è¯´æ˜
- [Swagger UI](http://localhost:3000/api-docs) - äº¤äº’å¼ API æ–‡æ¡£

---

## ğŸ”’ å®‰å…¨æ€§

- âœ… **JWT è®¤è¯** - Access Token (1h) + Refresh Token (7d)
- âœ… **bcrypt å¯†ç åŠ å¯†** - 10 rounds salt
- âœ… **CORS ä¿æŠ¤** - å¯é…ç½®å…è®¸çš„æ¥æº
- âœ… **Helmet å®‰å…¨å¤´** - é˜²æ­¢å¸¸è§ Web æ”»å‡»
- âœ… **é™æµä¿æŠ¤** - é˜²æ­¢æš´åŠ›ç ´è§£ (15 åˆ†é’Ÿ 100 æ¬¡)
- âœ… **å‚æ•°éªŒè¯** - class-validator è‡ªåŠ¨éªŒè¯
- âœ… **SQL æ³¨å…¥é˜²æŠ¤** - Prisma ORM å‚æ•°åŒ–æŸ¥è¯¢
- âœ… **XSS é˜²æŠ¤** - å‰ç«¯è¾“å…¥æ¸…ç†

---

## ğŸ“Š æµ‹è¯•è¦†ç›–ç‡

| æ¨¡å— | å•å…ƒæµ‹è¯• | E2E æµ‹è¯• | å‰ç«¯æµ‹è¯• | æ€»è®¡ |
|------|---------|---------|---------|------|
| åç«¯ | 42 | 37 | - | 79 |
| å‰ç«¯ | - | - | 28 | 28 |
| **æ€»è®¡** | **42** | **37** | **28** | **88** |

è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼š
```bash
# åç«¯æµ‹è¯•
cd backend && npm run test && npm run test:e2e

# å‰ç«¯æµ‹è¯•
cd frontend && npm run test
```

---

## ğŸ—‚ï¸ é¡¹ç›®ç»“æ„

```
xxljob-enhance/
â”œâ”€â”€ backend/                 # åç«¯ NestJS åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ auth/            # è®¤è¯æ¨¡å— (JWT)
â”‚   â”‚   â”œâ”€â”€ users/           # ç”¨æˆ·ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ roles/           # è§’è‰²ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ permissions/     # æƒé™æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ jobs/            # ä»»åŠ¡ä»£ç†
â”‚   â”‚   â”œâ”€â”€ xxljob/          # XXL-Job API é›†æˆ
â”‚   â”‚   â”œâ”€â”€ audit/           # å®¡è®¡æ—¥å¿—
â”‚   â”‚   â””â”€â”€ health/          # å¥åº·æ£€æŸ¥
â”‚   â”œâ”€â”€ prisma/              # Prisma Schema & è¿ç§»
â”‚   â”œâ”€â”€ test/                # E2E æµ‹è¯•
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ frontend/                # å‰ç«¯ React åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/      # UI ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ pages/           # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ contexts/        # React Context (AuthContext)
â”‚   â”‚   â”œâ”€â”€ api/             # API å®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ types/           # TypeScript ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ nginx.conf           # Nginx é…ç½®
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ docs/                    # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ deployment.md        # éƒ¨ç½²æŒ‡å—
â”‚   â”œâ”€â”€ api.md               # API æ–‡æ¡£
â”‚   â””â”€â”€ specs/               # éœ€æ±‚å’Œè®¾è®¡æ–‡æ¡£
â”œâ”€â”€ docker-compose.yml       # Docker Compose é…ç½®
â”œâ”€â”€ .env.example             # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â””â”€â”€ README.md                # æœ¬æ–‡ä»¶
```

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. æäº¤ Pull Request

### å¼€å‘è§„èŒƒ
- éµå¾ª ESLint å’Œ Prettier é…ç½®
- ä¸ºæ–°åŠŸèƒ½ç¼–å†™æµ‹è¯•
- æ›´æ–°ç›¸å…³æ–‡æ¡£

---

## ğŸ“ å¾…åŠäº‹é¡¹ (Roadmap)

- [ ] æ”¯æŒ PostgreSQL / MySQL æ•°æ®åº“
- [ ] å¤šç§Ÿæˆ·æ”¯æŒ
- [ ] æ›´ç»†ç²’åº¦çš„æ“ä½œå®¡è®¡
- [ ] å¯¼å‡ºå®¡è®¡æ—¥å¿—ä¸º CSV/Excel
- [ ] æ”¯æŒ LDAP / OAuth2 å•ç‚¹ç™»å½•
- [ ] å‰ç«¯å›½é™…åŒ– (i18n)
- [ ] å®æ—¶é€šçŸ¥ (WebSocket)
- [ ] Grafana / Prometheus ç›‘æ§é›†æˆ

---

## â“ å¸¸è§é—®é¢˜ (FAQ)

### Q: ä¸ºä»€ä¹ˆé€‰æ‹© SQLite è€Œä¸æ˜¯ PostgreSQLï¼Ÿ
A: SQLite é€‚åˆä¸­å°è§„æ¨¡éƒ¨ç½²ï¼Œæ— éœ€é¢å¤–çš„æ•°æ®åº“æœåŠ¡ã€‚å¦‚éœ€é«˜å¹¶å‘åœºæ™¯ï¼Œå¯ä»¥è½»æ¾åˆ‡æ¢åˆ° PostgreSQLï¼ˆåªéœ€ä¿®æ”¹ Prisma é…ç½®ï¼‰ã€‚

### Q: å¦‚ä½•è¿ç§»åˆ° PostgreSQLï¼Ÿ
A: ä¿®æ”¹ `backend/prisma/schema.prisma` ä¸­çš„ `datasource`ï¼Œç„¶åè¿è¡Œ `npx prisma migrate dev`ã€‚è¯¦è§ [Prisma æ–‡æ¡£](https://www.prisma.io/docs/concepts/database-connectors/postgresql)ã€‚

### Q: ç³»ç»Ÿæ”¯æŒå¤šå°‘ç”¨æˆ·ï¼Ÿ
A: åœ¨é»˜è®¤é…ç½®ä¸‹ï¼Œå¯æ”¯æŒæ•°ç™¾å¹¶å‘ç”¨æˆ·ã€‚å¦‚éœ€æ›´é«˜æ€§èƒ½ï¼Œå»ºè®®åˆ‡æ¢åˆ° PostgreSQL å¹¶å¯ç”¨è´Ÿè½½å‡è¡¡ã€‚

### Q: å¯ä»¥è„±ç¦» XXL-Job ä½¿ç”¨å—ï¼Ÿ
A: ä¸å¯ä»¥ã€‚æœ¬ç³»ç»Ÿæ˜¯ XXL-Job çš„å¢å¼ºå±‚ï¼Œä¾èµ– XXL-Job Admin API è·å–ä»»åŠ¡ä¿¡æ¯ã€‚

### Q: æ”¯æŒå“ªäº› XXL-Job ç‰ˆæœ¬ï¼Ÿ
A: ç†è®ºä¸Šæ”¯æŒæ‰€æœ‰æä¾› REST API çš„ XXL-Job ç‰ˆæœ¬ (>= 2.x)ã€‚å·²åœ¨ 2.3.x ç‰ˆæœ¬ä¸Šæµ‹è¯•ã€‚

---

## ğŸ“œ License

[MIT License](LICENSE)

---

## ğŸ™ è‡´è°¢

- [XXL-Job](https://github.com/xuxueli/xxl-job) - ä¼˜ç§€çš„åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å¹³å°
- [NestJS](https://nestjs.com/) - æ¸è¿›å¼ Node.js æ¡†æ¶
- [Prisma](https://www.prisma.io/) - ä¸‹ä¸€ä»£ TypeScript ORM
- [Ant Design](https://ant.design/) - ä¼ä¸šçº§ UI è®¾è®¡è¯­è¨€

---

## ğŸ“§ è”ç³»æ–¹å¼

- **Issue Tracker**: [GitHub Issues](https://github.com/your-org/xxljob-enhance/issues)
- **Email**: your-email@example.com

---

<p align="center">
  Made with â¤ï¸ by Your Team
</p>
